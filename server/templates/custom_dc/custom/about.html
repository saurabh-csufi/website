{#
 Copyright 2023 Google LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
#}

{%- extends BASE_HTML -%}

{% set main_id = 'standard-insights' %}
{% set page_id = 'page-standard-insights' %}
{% set title = 'India Export Insights' %}

{% block head %}
{{ super() }}
<script src="https://datacommons.org/datacommons.js"></script>
<style>
  :root {
    --saffron: #FF9933;
    --white: #FFFFFF;
    --green: #138808;
    --navy: #003366;
    --chakra-blue: #000080;
  }

  .insights-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .insights-header {
    text-align: center;
    margin-bottom: 2rem;
    padding: 2rem;
    background: linear-gradient(135deg, var(--saffron) 0%, var(--green) 100%);
    border-radius: 16px;
    color: white;
  }

  .insights-header h1 {
    font-size: 2.2rem;
    margin-bottom: 0.5rem;
    font-weight: 700;
  }

  .insights-header p {
    font-size: 1.1rem;
    opacity: 0.95;
  }

  .insights-header .badge {
    display: inline-block;
    background: rgba(255,255,255,0.2);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    margin-top: 0.5rem;
  }

  /* Highlight Section - Key Stats */
  .highlight-section {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .highlight-card {
    background: #fff;
    border-radius: 8px;
    padding: 1rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    border-top: 3px solid var(--navy);
  }

  .highlight-card.saffron {
    border-top-color: var(--saffron);
  }

  .highlight-card.green {
    border-top-color: var(--green);
  }

  /* Charts Grid */
  .insights-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .insight-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    padding: 1.5rem;
    min-height: 420px;
    border-top: 4px solid var(--navy);
  }

  .insight-card.saffron-border {
    border-top-color: var(--saffron);
  }

  .insight-card.green-border {
    border-top-color: var(--green);
  }

  .insight-card h3 {
    font-size: 1rem;
    color: var(--navy);
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid #e9ecef;
    font-weight: 600;
  }

  .full-width-card {
    grid-column: 1 / -1;
  }

  /* Section Headers */
  .section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 2rem 0 1rem 0;
    padding-bottom: 0.75rem;
    border-bottom: 3px solid var(--navy);
  }

  .section-header h2 {
    font-size: 1.3rem;
    color: var(--navy);
    margin: 0;
    font-weight: 600;
  }

  .section-header .icon {
    width: 36px;
    height: 36px;
    background: var(--saffron);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
  }

  /* Small Cards Grid for Gauge/Pie */
  .small-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .small-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    padding: 1.25rem;
    min-height: 320px;
  }

  .small-card h3 {
    font-size: 0.95rem;
    color: var(--navy);
    margin-bottom: 0.75rem;
    font-weight: 600;
  }

  /* Footer */
  .insights-footer {
    text-align: center;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 12px;
    margin-top: 2rem;
  }

  .insights-footer p {
    margin: 0 0 0.5rem 0;
    color: #666;
    font-size: 0.9rem;
  }

  .insights-footer a {
    color: var(--navy);
    text-decoration: none;
  }

  .insights-footer a:hover {
    text-decoration: underline;
  }

  /* Style datacommons-highlight for dark text */
  .highlight-card datacommons-highlight {
    --dc-highlight-header-color: var(--navy);
    --dc-highlight-value-color: var(--navy);
    --dc-highlight-text-color: #333;
  }

  /* Responsive */
  @media (max-width: 1200px) {
    .highlight-section {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 768px) {
    .highlight-section {
      grid-template-columns: repeat(2, 1fr);
    }
    .insights-grid {
      grid-template-columns: 1fr;
    }
    .insight-card {
      min-height: 350px;
    }
    .insights-header h1 {
      font-size: 1.6rem;
    }
    .small-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .highlight-section {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="insights-container">
  <!-- Header -->
  <div class="insights-header">
    <h1>India Export Insights Dashboard</h1>
    <p>Commodity-wise and Country-wise Export Data from EIDB</p>
    <span class="badge">Data: 2020-2025 | Source: Ministry of Commerce</span>
  </div>

  <!-- Key Highlights Section -->
  <div class="section-header">
    <div class="icon">₹</div>
    <h2>Key Export Statistics</h2>
  </div>

  <div class="highlight-section">
    <div class="highlight-card">
      <datacommons-highlight
        apiRoot="/"
        header="Petroleum Products"
        place="country/IND"
        variable="Exports_EconomicActivity_MineralFuelsMineralOilsAndProductsOfTheir"
      ></datacommons-highlight>
    </div>
    <div class="highlight-card saffron">
      <datacommons-highlight
        apiRoot="/"
        header="Electronics"
        place="country/IND"
        variable="Exports_EconomicActivity_ElectricalMachineryAndEquipmentAndPartsThereof"
      ></datacommons-highlight>
    </div>
    <div class="highlight-card green">
      <datacommons-highlight
        apiRoot="/"
        header="Machinery"
        place="country/IND"
        variable="Exports_EconomicActivity_MachineryAndMechanicalAppliancesBoilersNuclear"
      ></datacommons-highlight>
    </div>
    <div class="highlight-card saffron">
      <datacommons-highlight
        apiRoot="/"
        header="Gems & Jewellery"
        place="country/IND"
        variable="Exports_EconomicActivity_NaturalCulturedPearlsPreciousSemiPreciousStones"
      ></datacommons-highlight>
    </div>
    <div class="highlight-card green">
      <datacommons-highlight
        apiRoot="/"
        header="Pharmaceuticals"
        place="country/IND"
        variable="Exports_EconomicActivity_PharmaceuticalProducts"
      ></datacommons-highlight>
    </div>
  </div>

  <!-- Time Series Trends -->
  <div class="section-header">
    <div class="icon">~</div>
    <h2>Export Trends Over Time</h2>
  </div>

  <div class="insights-grid">
    <!-- Line Chart: Commodity Export Trends -->
    <div class="insight-card">
      <h3>Top Export Trends (2020-2025)</h3>
      <datacommons-line
        apiRoot="/"
        header="Export Values Over Time"
        places="country/IND"
        variables="Exports_EconomicActivity_MineralFuelsMineralOilsAndProductsOfTheir Exports_EconomicActivity_ElectricalMachineryAndEquipmentAndPartsThereof Exports_EconomicActivity_PharmaceuticalProducts"
      ></datacommons-line>
    </div>

    <!-- Bar Chart: Top Commodities -->
    <div class="insight-card saffron-border">
      <h3>Top 5 Export Categories Comparison</h3>
      <datacommons-bar
        apiRoot="/"
        header="Export Values by Category"
        places="country/IND"
        variables="Exports_EconomicActivity_MineralFuelsMineralOilsAndProductsOfTheir Exports_EconomicActivity_ElectricalMachineryAndEquipmentAndPartsThereof Exports_EconomicActivity_MachineryAndMechanicalAppliancesBoilersNuclear Exports_EconomicActivity_NaturalCulturedPearlsPreciousSemiPreciousStones Exports_EconomicActivity_PharmaceuticalProducts"
        sort="descending"
      ></datacommons-bar>
    </div>
  </div>

  <!-- Country-wise Exports Section -->
  <div class="section-header">
    <div class="icon">W</div>
    <h2>Country-wise Export Destinations</h2>
  </div>

  <div class="insights-grid">
    <!-- Bar Chart: Top Export Destinations -->
    <div class="insight-card green-border">
      <h3>Top Export Destination Countries</h3>
      <datacommons-bar
        apiRoot="/"
        header="India's Exports by Destination"
        places="country/USA country/ARE country/GBR country/DEU country/AUS country/CHN"
        variables="Exports_EconomicActivity_ExportSourceIndia"
        sort="descending"
      ></datacommons-bar>
    </div>

    <!-- Ranking Chart: Top Destinations -->
    <div class="insight-card">
      <h3>Ranking: Top Export Destinations</h3>
      <datacommons-bar
        apiRoot="/"
        header="Countries by Export Value from India"
        places="country/USA country/ARE country/NLD country/GBR country/CHN country/SGP country/BGD country/DEU country/SAU country/BEL"
        variables="Exports_EconomicActivity_ExportSourceIndia"
        sort="descending"
      ></datacommons-bar>
    </div>
  </div>

  <!-- Distribution Section -->
  <div class="section-header">
    <div class="icon">%</div>
    <h2>Export Distribution</h2>
  </div>

  <div class="small-grid">
    <!-- Pie Chart: Export Distribution -->
    <div class="small-card">
      <h3>Top 5 Export Distribution</h3>
      <datacommons-pie
        apiRoot="/"
        header="Top 5 Exports Breakdown"
        subheader="These 5 categories = 22.7% of total exports (₹16.84L Cr of ₹74.07L Cr)"
        place="country/IND"
        variables="Exports_EconomicActivity_MineralFuelsMineralOilsAndProductsOfTheir Exports_EconomicActivity_ElectricalMachineryAndEquipmentAndPartsThereof Exports_EconomicActivity_MachineryAndMechanicalAppliancesBoilersNuclear Exports_EconomicActivity_NaturalCulturedPearlsPreciousSemiPreciousStones Exports_EconomicActivity_PharmaceuticalProducts"
        donut
      ></datacommons-pie>
    </div>

    <!-- Gauge: Petroleum Growth Rate -->
    <div class="small-card">
      <h3>Petroleum Exports Growth Rate</h3>
      <datacommons-gauge
        apiRoot="/"
        header="Year-over-Year Growth (%)"
        place="country/IND"
        variable="GrowthRate_Exports_EconomicActivity_MineralFuelsMineralOilsAndProductsOfTheir"
        min="-50"
        max="50"
      ></datacommons-gauge>
    </div>

    <!-- Gauge: Pharma Growth Rate -->
    <div class="small-card">
      <h3>Pharma Exports Growth Rate</h3>
      <datacommons-gauge
        apiRoot="/"
        header="Year-over-Year Growth (%)"
        place="country/IND"
        variable="GrowthRate_Exports_EconomicActivity_PharmaceuticalProducts"
        min="-50"
        max="50"
      ></datacommons-gauge>
    </div>
  </div>

  <!-- Top Export Destinations Section -->
  <div class="section-header">
    <div class="icon">T</div>
    <h2>Top Export Destinations</h2>
  </div>

  <div class="insights-grid">
    <!-- Regional Export Comparison -->
    <div class="insight-card full-width-card">
      <h3>Export Value by Major Trading Partners</h3>
      <datacommons-bar
        apiRoot="/"
        header="India's Top 15 Export Destinations"
        places="country/USA country/ARE country/NLD country/GBR country/CHN country/SGP country/BGD country/DEU country/SAU country/BEL country/HKG country/AUS country/FRA country/ITA country/JPN"
        variables="Exports_EconomicActivity_ExportSourceIndia"
        sort="descending"
      ></datacommons-bar>
    </div>
  </div>

  <!-- Footer -->
  <div class="insights-footer">
    <p>
      Data Source: <a href="https://tradestat.commerce.gov.in/" target="_blank">Export Import Data Bank (EIDB)</a> - Ministry of Commerce & Industry, Government of India
    </p>
    <p>
      <a href="/explore">Search Data</a> |
      <a href="/tools/statvar">Browse Variables</a> |
      <a href="/tools/download">Download Data</a>
    </p>
    <p style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #dee2e6;">
      Powered by <a href="https://datacommons.org" target="_blank"><span style="color:#4285F4">G</span><span style="color:#EA4335">o</span><span style="color:#FBBC05">o</span><span style="color:#4285F4">g</span><span style="color:#34A853">l</span><span style="color:#EA4335">e</span></a> <a href="https://datacommons.org" target="_blank">Data Commons</a>
    </p>
  </div>
</div>

<script>
// Convert Billion/Trillion display to Crore (Indian numbering system)
// 1 Billion = 100 Crore, 1 Trillion = 1,00,000 Crore (1 Lakh Crore)
function convertToCrore(text) {
  // Match patterns like "5.66T", "532B", "2.08T", etc.
  const match = text.match(/^([\d.]+)([BTM])?$/i);
  if (!match) return text;

  let value = parseFloat(match[1]);
  const suffix = (match[2] || '').toUpperCase();

  // Convert to Crore
  let croreValue;
  if (suffix === 'T') {
    // Trillion to Crore: 1T = 1,00,000 Crore
    croreValue = value * 100000;
  } else if (suffix === 'B') {
    // Billion to Crore: 1B = 100 Crore
    croreValue = value * 100;
  } else if (suffix === 'M') {
    // Million to Crore: 1M = 0.1 Crore
    croreValue = value * 0.1;
  } else {
    return text;
  }

  // Format in Indian style with Lakh Crore if needed
  if (croreValue >= 100000) {
    // Show as Lakh Crore
    const lakhCrore = croreValue / 100000;
    return lakhCrore.toFixed(2) + ' L Cr';
  } else if (croreValue >= 1000) {
    // Show in thousands of crore with comma
    return croreValue.toLocaleString('en-IN', {maximumFractionDigits: 0}) + ' Cr';
  } else {
    return croreValue.toFixed(0) + ' Cr';
  }
}

function updateHighlightValues() {
  // Find all highlight cards and update their displayed values
  const highlights = document.querySelectorAll('datacommons-highlight');
  highlights.forEach(highlight => {
    const shadowRoot = highlight.shadowRoot;
    if (shadowRoot) {
      // Look for the big number display
      const bigNum = shadowRoot.querySelector('.big-num, .highlight-value, [class*="value"]');
      if (bigNum && bigNum.textContent) {
        const original = bigNum.textContent.trim();
        const converted = convertToCrore(original);
        if (converted !== original) {
          bigNum.textContent = converted;
        }
      }
    }
  });
}

// Use MutationObserver to detect when highlight values are rendered
document.addEventListener('DOMContentLoaded', function() {
  // Initial check after a delay for components to load
  setTimeout(updateHighlightValues, 2000);
  setTimeout(updateHighlightValues, 4000);

  // Also observe for changes
  const observer = new MutationObserver(function(mutations) {
    updateHighlightValues();
  });

  // Observe the highlight section
  const highlightSection = document.querySelector('.highlight-section');
  if (highlightSection) {
    observer.observe(highlightSection, {
      childList: true,
      subtree: true,
      characterData: true
    });
  }
});
</script>
{% endblock %}
